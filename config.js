export const DEFAULT_CONFIG={supabaseUrl:"https://arslamcjzixeqmalscye.supabase.co",supabaseKey:"sb_publishable_VDYPdce8BVPg_J9kzFgKpA_dYAfDcP4",targetDomain:"https://www.netflix.com",baseDomain:".netflix.com",remoteConfigUrl:null,remoteConfigPublicKeyJwk:null};function e(e){const n=atob(e),t=new Uint8Array(n.length);for(let e=0;e<n.length;e++)t[e]=n.charCodeAt(e);return t}async function n(n,t){if(!n||!n.payload||!n.signature)return null;try{const o=e(n.payload),r=e(n.signature),a=await async function(e){return crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}(t);if(!await crypto.subtle.verify({name:"ECDSA",hash:"SHA-256"},a,r,o))return null;const i=(new TextDecoder).decode(o);return JSON.parse(i)}catch(e){return console.warn("Remote config signature verification failed:",e),null}}export async function loadConfig(){try{if(!DEFAULT_CONFIG.remoteConfigUrl)return DEFAULT_CONFIG;if(!DEFAULT_CONFIG.remoteConfigPublicKeyJwk)return console.warn("Remote config disabled: missing public key."),DEFAULT_CONFIG;console.log("Attempting to fetch remote config from:",DEFAULT_CONFIG.remoteConfigUrl);const e=await fetch(DEFAULT_CONFIG.remoteConfigUrl,{cache:"no-store"});if(!e.ok)throw new Error("Fetch failed");const t=await e.json(),o=await n(t,DEFAULT_CONFIG.remoteConfigPublicKeyJwk);return o?{...DEFAULT_CONFIG,...o}:(console.warn("Remote config signature invalid. Using defaults."),DEFAULT_CONFIG)}catch(e){return console.warn("Could not load remote config, using default:",e),{...DEFAULT_CONFIG}}}